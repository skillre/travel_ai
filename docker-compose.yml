version: '3'

services:
  travel-ai:
    container_name: travel-ai
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_AMAP_KEY: ${NEXT_PUBLIC_AMAP_KEY}
        NEXT_PUBLIC_MAPBOX_TOKEN: ${NEXT_PUBLIC_MAPBOX_TOKEN}
    restart: always
    ports:
      - 3000:3000
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      
      # ========== Notion 配置 ==========
      # 通用 Notion API Key (复用)
      - NOTION_API_KEY=${NOTION_API_KEY}
      # 行程历史数据库 ID
      - NOTION_DATABASE_ID=${NOTION_DATABASE_ID}
      # 解锁码数据库 ID
      - NOTION_UNLOCK_DATABASE_ID=${NOTION_UNLOCK_DATABASE_ID}
      # 图片缓存数据库 ID (新增)
      - NOTION_IMAGE_DATABASE_ID=${NOTION_IMAGE_DATABASE_ID}
      
      # ========== Dify 配置 ==========
      # 行程生成工作流
      - DIFY_API_KEY=${DIFY_API_KEY}
      - DIFY_API_URL=${DIFY_API_URL}
      # 图片搜索工作流 (新增)
      - DIFY_IMAGE_API_KEY=${DIFY_IMAGE_API_KEY}
      - DIFY_IMAGE_API_URL=${DIFY_IMAGE_API_URL}
      
      # ========== 其他配置 ==========
      # Unsplash 回退配置 (可选)
      - UNSPLASH_ACCESS_KEY=${UNSPLASH_ACCESS_KEY}
      # Mapbox Token (客户端)
      - NEXT_PUBLIC_MAPBOX_TOKEN=${NEXT_PUBLIC_MAPBOX_TOKEN}
      
      # ========== 阿里云 OSS 配置 (用户头像存储) ==========
      - OSS_ACCESS_KEY_ID=${OSS_ACCESS_KEY_ID}
      - OSS_ACCESS_KEY_SECRET=${OSS_ACCESS_KEY_SECRET}
      - OSS_BUCKET_NAME=${OSS_BUCKET_NAME}
      - OSS_REGION=${OSS_REGION}
      - OSS_PUBLIC_URL=${OSS_PUBLIC_URL}
      # OSS 内网端点 (可选)
      - OSS_INTERNAL_ENDPOINT=${OSS_INTERNAL_ENDPOINT}
